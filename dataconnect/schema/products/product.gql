# ============================================================================
# PRODUCT MASTER DATA
# ============================================================================

"""
Core product entity representing a unique pharmaceutical item.
Represents the master record for a drug product.
"""
type Product @table {
  id: UUID! @default(expr: "uuidV4()")
  business: Business!
  businessId: UUID!

  # Identity & Classification
  genericName: String! @col(dataType: "varchar(255)")
  brandName: String @col(dataType: "varchar(255)")
  manufacturer: Manufacturer!
  nationalDrugCode: String @col(dataType: "varchar(50)")
  barcode: String @col(dataType: "varchar(100)")
  upc: String @col(dataType: "varchar(50)")
  internalSKU: String! @col(dataType: "varchar(100)")

  # Drug-Specific Attributes
  dosageForm: DosageForm! @col(dataType: "dosage_form")
  strength: String! @col(dataType: "varchar(50)")
  unit: String! @col(dataType: "varchar(20)")
  routeOfAdministration: RouteOfAdministration! @col(dataType: "route_of_administration")

  # Composition
  activeIngredients: String @col(dataType: "jsonb")
  inactiveIngredients: [String!] @col(dataType: "jsonb")

  # Regulatory & Safety
  drugSchedule: DrugSchedule! @col(dataType: "drug_schedule")
  deaSchedule: DeaSchedule @col(dataType: "dea_schedule")
  requiresPrescription: Boolean! @default(value: true)
  pregnancyCategory: PregnancyCategory @col(dataType: "pregnancy_category")
  fdaApprovalStatus: FdaApprovalStatus @col(dataType: "fda_approval_status")

  # Clinical Information
  therapeuticClass: TherapeuticClass!
  therapeuticSubclass: TherapeuticSubclass
  contraindications: [String!] @col(dataType: "jsonb")
  blackBoxWarnings: [String!] @col(dataType: "jsonb")
  standardDosing: String @col(dataType: "text")
  maximumDailyDose: String @col(dataType: "varchar(100)")

  # Drug Interactions
  interactions: String @col(dataType: "jsonb")

  # Packaging
  packageSize: Int!
  packageUnit: PackageUnit! @col(dataType: "package_unit")
  bulkPackaging: String @col(dataType: "jsonb")

  # Storage Requirements
  storageTemperature: String @col(dataType: "jsonb")
  requiresRefrigeration: Boolean! @default(value: false)
  requiresControlledSubstanceVault: Boolean! @default(value: false)
  isLightSensitive: Boolean! @default(value: false)
  isHazardousDrug: Boolean! @default(value: false)

  # Reconstitution (for compounds)
  requiresReconstitution: Boolean! @default(value: false)
  reconstitutionInstructions: String @col(dataType: "text")
  beyondUseDateAfterReconstitution: Int

  # Inventory Management
  reorderPoint: Int!
  reorderQuantity: Int!
  maximumStockLevel: Int
  minimumStockLevel: Int!
  averageDailyUsage: Float
  isFastMover: Boolean! @default(value: false)

  # Pricing
  pricing: ProductPricing
  pricingId: UUID

  # Supplier Information
  primarySupplier: Supplier!
  alternativeSuppliers: String @col(dataType: "jsonb")
  leadTimeDays: Int!
  minimumOrderQuantity: Int

  # Insurance & Formulary
  formularyStatus: String @col(dataType: "jsonb")
  therapeuticEquivalenceCode: String @col(dataType: "varchar(10)")
  substitutionRules: String @col(dataType: "jsonb")

  # Multi-level Expiry Warnings (configurable per product)
  expiryWarningThresholds: ExpiryWarningThresholds
  expiryWarningThresholdsId: UUID

  # Images & Documents
  images: [String!] @col(dataType: "jsonb")
  productInsert: String @col(dataType: "varchar(500)")
  safetyDataSheet: String @col(dataType: "varchar(500)")

  # Metadata
  isActive: Boolean! @default(value: true)
  isDiscontinued: Boolean! @default(value: false)
  discontinuedDate: Date
  category: ProductCategory! @col(dataType: "product_category")
  subcategory: ProductSubcategory @col(dataType: "product_subcategory")

  # Audit
  createdAt: Timestamp! @default(expr: "request.time")
  updatedAt: Timestamp! @default(expr: "request.time")
  createdBy: User!
  updatedBy: User!
}

"""
Active pharmaceutical ingredient in a product.
Supports multi-ingredient formulations.
"""
type ActiveIngredient @table {
  id: UUID! @default(expr: "uuidV4()")
  product: Product!
  productId: UUID!
  name: String! @col(dataType: "varchar(255)")
  strength: String! @col(dataType: "varchar(50)")
  unit: String! @col(dataType: "varchar(20)")
}



