# ============================================================================
# MESSAGING & COMMUNICATION
# ============================================================================

"""
Real-time messaging between users.
"""
type Message @table {
  id: UUID! @default(expr: "uuidV4()")
  business: Business!
  businessId: UUID!

  # Conversation
  conversation: Conversation!
  conversationId: UUID!

  # Content
  content: String! @col(dataType: "text")
  messageType: MessageType! @col(dataType: "message_type")

  # Sender
  sender: User!
  senderId: String!

  # Timestamps
  sentAt: Date! @default(expr: "request.time")
  editedAt: Date

  # Attachments
  attachments: String @col(dataType: "jsonb")

  # Read Status
  readBy: String @col(dataType: "jsonb")
}

"""
Conversation thread for messages.
"""
type Conversation @table {
  id: UUID! @default(expr: "uuidV4()")
  business: Business!
  businessId: UUID!

  # Participants
  participants: String @col(dataType: "jsonb")
  participantIds: [String!] @col(dataType: "jsonb")

  # Details
  title: String @col(dataType: "varchar(255)")
  isGroup: Boolean! @default(value: false)
  isActive: Boolean! @default(value: true)

  # Last Message
  lastMessageAt: Date
  lastMessagePreview: String @col(dataType: "varchar(500)")

  # Metadata
  createdAt: Date! @default(expr: "request.time")
  createdBy: User!
  createdById: String!
}

"""
Message attachment.
"""
type MessageAttachment @table {
  id: UUID! @default(expr: "uuidV4()")
  fileName: String!
  fileUrl: String!
  fileType: String!
  fileSize: Int!
  uploadedAt: Date!
}

"""
Read receipt for messages.
"""
type MessageReadReceipt @table {
  id: UUID! @default(expr: "uuidV4()")
  userId: String!
  readAt: Date!
}



