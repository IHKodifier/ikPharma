# ============================================================================
# SALES & TRANSACTIONS
# ============================================================================

"""
Sales transaction representing a POS sale.
Supports line items, payments, and returns.
"""
type SalesTransaction @table {
  id: UUID! @default(expr: "uuidV4()")
  business: Business!
  businessId: UUID!
  location: Location!
  locationId: UUID!

  # Transaction Details
  transactionNumber: String! @col(dataType: "varchar(50)")
  transactionDate: Timestamp! @default(expr: "request.time")
  transactionType: TransactionType! @col(dataType: "transaction_type")

  # Customer Information
  customer: Customer
  customerId: UUID
  isWalkIn: Boolean! @default(value: true)

  # Financial
  subtotal: Float!
  taxAmount: Float!
  discountAmount: Float! @default(value: 0)
  totalAmount: Float!

  # Payment
  payments: String @col(dataType: "jsonb")

  # Status
  status: TransactionStatus! @col(dataType: "transaction_status")
  isVoided: Boolean! @default(value: false)
  voidReason: String @col(dataType: "varchar(255)")

  # Staff
  cashier: User!
  cashierId: String!

  # Audit
  createdAt: Timestamp! @default(expr: "request.time")
  updatedAt: Timestamp! @default(expr: "request.time")
}

"""
Line item in a sales transaction.
"""
type SalesLineItem @table {
  id: UUID! @default(expr: "uuidV4()")
  transaction: SalesTransaction!
  transactionId: UUID!
  product: Product!
  productId: UUID!
  batch: ProductBatch!
  batchId: UUID!

  # Product Details
  quantity: Int!
  unitPrice: Float!
  discountPercent: Float! @default(value: 0)
  discountAmount: Float! @default(value: 0)
  lineTotal: Float!

  # Batch Tracking
  dispensedFromBatch: ProductBatch!
  dispensedFromBatchId: UUID!

  # Returns
  returnedQuantity: Int! @default(value: 0)
  returnReason: String @col(dataType: "varchar(255)")
}

"""
Payment record for a transaction.
"""
type Payment @table {
  id: UUID! @default(expr: "uuidV4()")
  paymentMethod: PaymentMethod!
  amount: Float!
  referenceNumber: String
  paymentDate: Timestamp!
  processedBy: User!
  processedById: String!
}



